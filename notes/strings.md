String encoding in Yul 

How does solidity encode strings into storage?  

# Encoding scheme

Short String <= 31 bytes 

Long string  > 31 bytes in length 

Short strings are encoded in a single storage slot

Long strings are encoded in multiple slots 

In the first storage slot, the lowest order bit stores a 0 if the value is a short string and 1 for a long string. 

If the value is a long string, then the total length is stored in the first slot. 

Length is always stored as 2x length.  

# Short strings

ABI encoded "Hello world"    

``0000000000000000000000000000000000000000000000000000000000000020``

``000000000000000000000000000000000000000000000000000000000000000b``

``48656c6c6f20576f726c64000000000000000000000000000000000000000000``

Soldity encoded Hello world 

16 hex = 22.  22 = 2x length of Hello world

``0000000000000000000000000000000000000000000000000000000000000016``

Hex encoded bytes 48=H , 65=e, 6c=l , etc. 

``48656c6c6f20576f726c64000000000000000000000000000000000000000000``

``48656c6c6f20576f726c64000000000000000000000000000000000000000016``

# calldata

``7fcaf6660000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000b48656c6c6f20576f726c64000000000000000000000000000000000000000000
``

## Long String

``7fcaf666``

``0000000000000000000000000000000000000000000000000000000000000020``

``0000000000000000000000000000000000000000000000000000000000000028``

``3132333435363738393031323334353637383930313233343536373839303132``

``3334353637383930000000000000000000000000000000000000000000000000``

[
 "0x0000000000000000000000000000000000000000000000000000000000000002",
 "0x0000000000000000000000000000000000000000000000000000000000000051",
 "0x0000000000000000000000000000000000000000000000000000000000000001",
 "0x0000000000000000000000000000000000000000000000000000000000000044",
 "0x0000000000000000000000000000000000000000000000000000000000000028",
 "0x0000000000000000000000000000000000000000000000000000000000000020",
 "0x0000000000000000000000000000000000000000000000000000000000000028",
 "0x0000000000000000000000000000000000000000000000000000000000000044",
 "0x00000000000000000000000000000000000000000000000000000000000000ba",
 "0x000000000000000000000000000000000000000000000000000000007fcaf666"
]

[
 "0x405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace",
 "0x3132333435363738393031323334353637383930313233343536373839303132",
 "0x0000000000000000000000000000000000000000000000000000000000000000",
 "0x405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace",
 "0x0000000000000000000000000000000000000000000000000000000000000001",
 "0x0000000000000000000000000000000000000000000000000000000000000044",
 "0x0000000000000000000000000000000000000000000000000000000000000028",
 "0x0000000000000000000000000000000000000000000000000000000000000020",
 "0x0000000000000000000000000000000000000000000000000000000000000028",
 "0x0000000000000000000000000000000000000000000000000000000000000044",
 "0x00000000000000000000000000000000000000000000000000000000000000ba",
 "0x000000000000000000000000000000000000000000000000000000007fcaf666"
]

[
 "0x405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5acf",
 "0x3334353637383930000000000000000000000000000000000000000000000000",
 "0x0000000000000000000000000000000000000000000000000000000000000001",
 "0x405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace",
 "0x0000000000000000000000000000000000000000000000000000000000000001",
 "0x0000000000000000000000000000000000000000000000000000000000000064",
 "0x0000000000000000000000000000000000000000000000000000000000000028",
 "0x0000000000000000000000000000000000000000000000000000000000000020",
 "0x0000000000000000000000000000000000000000000000000000000000000028",
 "0x0000000000000000000000000000000000000000000000000000000000000044",
 "0x00000000000000000000000000000000000000000000000000000000000000ba",
 "0x000000000000000000000000000000000000000000000000000000007fcaf666"
]

{
 "0x0": "0000000000000000000000000000000000000000000000000000000000000002\t????????????????????????????????",
 "0x20": "0000000000000000000000000000000000000000000000000000000000000000\t????????????????????????????????",
 "0x40": "0000000000000000000000000000000000000000000000000000000000000080\t????????????????????????????????"
}

![](/home/khegeman/.config/marktext/images/2023-06-19-21-22-46-image.png)
